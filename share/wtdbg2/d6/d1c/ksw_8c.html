<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>wtdbg: ksw.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">wtdbg
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('d6/d1c/ksw_8c.html','../../');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">ksw.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;emmintrin.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../">ksw.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ksw.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d0f/ksw_8c__incl.png" border="0" usemap="#ksw_8c" alt=""/></div>
<map name="ksw_8c" id="ksw_8c">
<area shape="rect"  title=" " alt="" coords="129,5,187,32"/>
<area shape="rect"  title=" " alt="" coords="5,80,76,107"/>
<area shape="rect"  title=" " alt="" coords="176,155,247,181"/>
<area shape="rect"  title=" " alt="" coords="152,80,255,107"/>
<area shape="rect"  href="../../d5/d97/ksw_8h.html" title=" " alt="" coords="279,80,338,107"/>
</map>
</div>
</div>
<p><a href="">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/dff/struct__kswq__t.html">_kswq_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d2d/structeh__t.html">eh_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:affde14445f49f65ff4f5b592e44ee71a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(x)&#160;&#160;&#160;(x)</td></tr>
<tr class="separator:affde14445f49f65ff4f5b592e44ee71a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab10d0a221f4d7a706701b806c8135fd7"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a>(x)&#160;&#160;&#160;(x)</td></tr>
<tr class="separator:ab10d0a221f4d7a706701b806c8135fd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4bd40006efbe6d978381de40766e3b63"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a4bd40006efbe6d978381de40766e3b63">__max_16</a>(ret,  xx)</td></tr>
<tr class="separator:a4bd40006efbe6d978381de40766e3b63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a287a82314c2dd8a20b9aea52a422a34b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a287a82314c2dd8a20b9aea52a422a34b">__max_8</a>(ret,  xx)</td></tr>
<tr class="separator:a287a82314c2dd8a20b9aea52a422a34b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa48b28e62c168ecef26792b023bedb09"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>&#160;&#160;&#160;-0x40000000</td></tr>
<tr class="separator:aa48b28e62c168ecef26792b023bedb09"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a295f1f9c1e0144e81d4c5900a6698601"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a295f1f9c1e0144e81d4c5900a6698601">ksw_qinit</a> (int size, int qlen, const uint8_t *query, int m, const int8_t *mat)</td></tr>
<tr class="separator:a295f1f9c1e0144e81d4c5900a6698601"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09be34a2ff991aeb136cdc5c98719111"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a09be34a2ff991aeb136cdc5c98719111">ksw_u8</a> (<a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> *q, int tlen, const uint8_t *target, int _o_del, int _e_del, int _o_ins, int _e_ins, int xtra)</td></tr>
<tr class="separator:a09be34a2ff991aeb136cdc5c98719111"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa24677fdc656c726046b3166b8286bea"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#aa24677fdc656c726046b3166b8286bea">ksw_i16</a> (<a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> *q, int tlen, const uint8_t *target, int _o_del, int _e_del, int _o_ins, int _e_ins, int xtra)</td></tr>
<tr class="separator:aa24677fdc656c726046b3166b8286bea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b86b0e1cab2423ed292be074a3c5c27"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a9b86b0e1cab2423ed292be074a3c5c27">revseq</a> (int l, uint8_t *s)</td></tr>
<tr class="separator:a9b86b0e1cab2423ed292be074a3c5c27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6a01aa7df675160895b0a5100b6134c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#ae6a01aa7df675160895b0a5100b6134c">ksw_align2</a> (int qlen, uint8_t *query, int tlen, uint8_t *target, int m, const int8_t *mat, int o_del, int e_del, int o_ins, int e_ins, int xtra, <a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> **qry)</td></tr>
<tr class="separator:ae6a01aa7df675160895b0a5100b6134c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa77df9211e983ff979de29cba01a9263"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#aa77df9211e983ff979de29cba01a9263">ksw_align</a> (int qlen, uint8_t *query, int tlen, uint8_t *target, int m, const int8_t *mat, int gapo, int gape, int xtra, <a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> **qry)</td></tr>
<tr class="separator:aa77df9211e983ff979de29cba01a9263"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5d54be11b210ddd9dae4be394350a59"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#af5d54be11b210ddd9dae4be394350a59">ksw_extend2</a> (int qlen, const uint8_t *query, int tlen, const uint8_t *target, int m, const int8_t *mat, int o_del, int e_del, int o_ins, int e_ins, int w, int end_bonus, int zdrop, int h0, int *_qle, int *_tle, int *_gtle, int *_gscore, int *_max_off)</td></tr>
<tr class="separator:af5d54be11b210ddd9dae4be394350a59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8bd8bb5a192234c25cae54feb3471ea5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a8bd8bb5a192234c25cae54feb3471ea5">ksw_extend</a> (int qlen, const uint8_t *query, int tlen, const uint8_t *target, int m, const int8_t *mat, int gapo, int gape, int w, int end_bonus, int zdrop, int h0, int *qle, int *tle, int *gtle, int *gscore, int *max_off)</td></tr>
<tr class="separator:a8bd8bb5a192234c25cae54feb3471ea5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a826957eb948116d000d8514b3cd85202"><td class="memItemLeft" align="right" valign="top">static uint32_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a> (int *n_cigar, int *m_cigar, uint32_t *cigar, int op, int len)</td></tr>
<tr class="separator:a826957eb948116d000d8514b3cd85202"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3429600af32881906c7327a78e4e284"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#ab3429600af32881906c7327a78e4e284">ksw_global2</a> (int qlen, const uint8_t *query, int tlen, const uint8_t *target, int m, const int8_t *mat, int o_del, int e_del, int o_ins, int e_ins, int w, int *n_cigar_, uint32_t **cigar_)</td></tr>
<tr class="separator:ab3429600af32881906c7327a78e4e284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b3b660c0554a2d9817528194b6578a3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#a7b3b660c0554a2d9817528194b6578a3">ksw_global</a> (int qlen, const uint8_t *query, int tlen, const uint8_t *target, int m, const int8_t *mat, int gapo, int gape, int w, int *n_cigar_, uint32_t **cigar_)</td></tr>
<tr class="separator:a7b3b660c0554a2d9817528194b6578a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:add79ed614f910c5fcae1eead30104f28"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d1c/ksw_8c.html#add79ed614f910c5fcae1eead30104f28">g_defr</a> = { 0, -1, -1, -1, -1, -1, -1 }</td></tr>
<tr class="separator:add79ed614f910c5fcae1eead30104f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a4bd40006efbe6d978381de40766e3b63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4bd40006efbe6d978381de40766e3b63">&#9670;&nbsp;</a></span>__max_16</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __max_16</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ret, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">xx&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 8)); \</div><div class="line">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 4)); \</div><div class="line">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 2)); \</div><div class="line">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 1)); \</div><div class="line">        (ret) = _mm_extract_epi16((xx), 0) &amp; 0x00ff; \</div><div class="line">    } <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
</div>
</div>
<a id="a287a82314c2dd8a20b9aea52a422a34b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a287a82314c2dd8a20b9aea52a422a34b">&#9670;&nbsp;</a></span>__max_8</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __max_8</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ret, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">xx&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> { \</div><div class="line">        (xx) = _mm_max_epi16((xx), _mm_srli_si128((xx), 8)); \</div><div class="line">        (xx) = _mm_max_epi16((xx), _mm_srli_si128((xx), 4)); \</div><div class="line">        (xx) = _mm_max_epi16((xx), _mm_srli_si128((xx), 2)); \</div><div class="line">        (ret) = _mm_extract_epi16((xx), 0); \</div><div class="line">    } <span class="keywordflow">while</span> (0)</div></div><!-- fragment -->
</div>
</div>
<a id="affde14445f49f65ff4f5b592e44ee71a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affde14445f49f65ff4f5b592e44ee71a">&#9670;&nbsp;</a></span>LIKELY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LIKELY</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa48b28e62c168ecef26792b023bedb09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa48b28e62c168ecef26792b023bedb09">&#9670;&nbsp;</a></span>MINUS_INF</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MINUS_INF&#160;&#160;&#160;-0x40000000</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ab10d0a221f4d7a706701b806c8135fd7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab10d0a221f4d7a706701b806c8135fd7">&#9670;&nbsp;</a></span>UNLIKELY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UNLIKELY</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(x)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa77df9211e983ff979de29cba01a9263"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa77df9211e983ff979de29cba01a9263">&#9670;&nbsp;</a></span>ksw_align()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a> ksw_align </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gapo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xtra</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> **&#160;</td>
          <td class="paramname"><em>qry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Aligning two sequences</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qlen</td><td>length of the query sequence (typically &lt;tlen) </td></tr>
    <tr><td class="paramname">query</td><td>query sequence with 0 &lt;= query[i] &lt; m </td></tr>
    <tr><td class="paramname">tlen</td><td>length of the target sequence </td></tr>
    <tr><td class="paramname">target</td><td>target sequence </td></tr>
    <tr><td class="paramname">m</td><td>number of residue types </td></tr>
    <tr><td class="paramname">mat</td><td>m*m scoring matrix in one-dimension array </td></tr>
    <tr><td class="paramname">gapo</td><td>gap open penalty; a gap of length l cost "-(gapo+l*gape)" </td></tr>
    <tr><td class="paramname">gape</td><td>gap extension penalty </td></tr>
    <tr><td class="paramname">xtra</td><td>extra information (see below) </td></tr>
    <tr><td class="paramname">qry</td><td>query profile (see below)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>alignment information in a struct; unset values to -1</dd></dl>
<p>When xtra==0, <a class="el" href="../../d5/d97/ksw_8h.html#aa77df9211e983ff979de29cba01a9263">ksw_align()</a> uses a signed two-byte integer to store a score and only finds the best score and the end positions. The 2nd best score or the start positions are not attempted. The default behavior can be tuned by setting KSW_X* flags:</p>
<p>KSW_XBYTE: use an unsigned byte to store a score. If overflow occurs, <a class="el" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">kswr_t::score</a> will be set to 255</p>
<p>KSW_XSUBO: track the 2nd best score and the ending position on the target if the 2nd best is higher than (xtra&amp;0xffff)</p>
<p>KSW_XSTOP: stop if the maximum score is above (xtra&amp;0xffff)</p>
<p>KSW_XSTART: find the start positions</p>
<p>When *qry==NULL, <a class="el" href="../../d5/d97/ksw_8h.html#aa77df9211e983ff979de29cba01a9263">ksw_align()</a> will compute and allocate the query profile and when the function returns, *qry will point to the profile, which can be deallocated simply by free(). If one query is aligned against multiple target sequences, *qry should be set to NULL during the first call and freed after the last call. Note that qry can equal 0. In this case, the query profile will be deallocated in <a class="el" href="../../d5/d97/ksw_8h.html#aa77df9211e983ff979de29cba01a9263">ksw_align()</a>. </p>
<div class="fragment"><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;{</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/d1c/ksw_8c.html#ae6a01aa7df675160895b0a5100b6134c">ksw_align2</a>(qlen, query, tlen, target, m, mat, gapo, gape, gapo, gape, xtra, qry);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div><div class="ttc" id="ksw_8c_html_ae6a01aa7df675160895b0a5100b6134c"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#ae6a01aa7df675160895b0a5100b6134c">ksw_align2</a></div><div class="ttdeci">kswr_t ksw_align2(int qlen, uint8_t *query, int tlen, uint8_t *target, int m, const int8_t *mat, int o_del, int e_del, int o_ins, int e_ins, int xtra, kswq_t **qry)</div><div class="ttdef"><b>Definition:</b> ksw.c:344</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae6a01aa7df675160895b0a5100b6134c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6a01aa7df675160895b0a5100b6134c">&#9670;&nbsp;</a></span>ksw_align2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a> ksw_align2 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>o_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>e_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>o_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>e_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xtra</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> **&#160;</td>
          <td class="paramname"><em>qry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;{</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">int</span> size;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="../../dd/dff/struct__kswq__t.html">kswq_t</a> *q;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="../../de/d25/structkswr__t.html">kswr_t</a> r, rr;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <a class="code" href="../../de/d25/structkswr__t.html">kswr_t</a> (*func)(<a class="code" href="../../dd/dff/struct__kswq__t.html">kswq_t</a>*, int, <span class="keyword">const</span> uint8_t*, int, int, int, int, int);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    q = (qry &amp;&amp; *qry)? *qry : <a class="code" href="../../d6/d1c/ksw_8c.html#a295f1f9c1e0144e81d4c5900a6698601">ksw_qinit</a>((xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#a388a8f0d345df67b79d92976a394ebab">KSW_XBYTE</a>)? 1 : 2, qlen, query, m, mat);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    <span class="keywordflow">if</span> (qry &amp;&amp; *qry == 0) *qry = q;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    func = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a7ba48bac78067bfea3285e0a868a685e">size</a> == 2? <a class="code" href="../../d6/d1c/ksw_8c.html#aa24677fdc656c726046b3166b8286bea">ksw_i16</a> : <a class="code" href="../../d6/d1c/ksw_8c.html#a09be34a2ff991aeb136cdc5c98719111">ksw_u8</a>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    size = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a7ba48bac78067bfea3285e0a868a685e">size</a>;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    r = func(q, tlen, target, o_del, e_del, o_ins, e_ins, xtra);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="keywordflow">if</span> (qry == 0) free(q);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="keywordflow">if</span> ((xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#a9cbd7ce1bac8e3745b5fa1c4f2a25000">KSW_XSTART</a>) == 0 || ((xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#ad6340ae00716e79b4d820303710f5a21">KSW_XSUBO</a>) &amp;&amp; r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a> &lt; (xtra&amp;0xffff))) <span class="keywordflow">return</span> r;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="../../d6/d1c/ksw_8c.html#a9b86b0e1cab2423ed292be074a3c5c27">revseq</a>(r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> + 1, query); <a class="code" href="../../d6/d1c/ksw_8c.html#a9b86b0e1cab2423ed292be074a3c5c27">revseq</a>(r.<a class="code" href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">te</a> + 1, target); <span class="comment">// +1 because qe/te points to the exact end, not the position after the end</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    q = <a class="code" href="../../d6/d1c/ksw_8c.html#a295f1f9c1e0144e81d4c5900a6698601">ksw_qinit</a>(size, r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> + 1, query, m, mat);</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    rr = func(q, tlen, target, o_del, e_del, o_ins, e_ins, <a class="code" href="../../d5/d97/ksw_8h.html#a3e95112abfdfa3f0e7ba8b1a4934e24f">KSW_XSTOP</a> | r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a>);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="../../d6/d1c/ksw_8c.html#a9b86b0e1cab2423ed292be074a3c5c27">revseq</a>(r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> + 1, query); <a class="code" href="../../d6/d1c/ksw_8c.html#a9b86b0e1cab2423ed292be074a3c5c27">revseq</a>(r.<a class="code" href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">te</a> + 1, target);</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    free(q);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">if</span> (r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a> == rr.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a>)</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        r.<a class="code" href="../../de/d25/structkswr__t.html#aa7ec982fe74fbb60b2cba04568c31295">tb</a> = r.<a class="code" href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">te</a> - rr.<a class="code" href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">te</a>, r.<a class="code" href="../../de/d25/structkswr__t.html#a726f86a2e3be73519fa46b2a44f64a5f">qb</a> = r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> - rr.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    <span class="keywordflow">return</span> r;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div><div class="ttc" id="struct__kswq__t_html"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html">_kswq_t</a></div><div class="ttdef"><b>Definition:</b> ksw.c:45</div></div>
<div class="ttc" id="structkswr__t_html_aa7ec982fe74fbb60b2cba04568c31295"><div class="ttname"><a href="../../de/d25/structkswr__t.html#aa7ec982fe74fbb60b2cba04568c31295">kswr_t::tb</a></div><div class="ttdeci">int tb</div><div class="ttdef"><b>Definition:</b> ksw.h:18</div></div>
<div class="ttc" id="struct__kswq__t_html_a7ba48bac78067bfea3285e0a868a685e"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a7ba48bac78067bfea3285e0a868a685e">_kswq_t::size</a></div><div class="ttdeci">uint8_t size</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="ksw_8h_html_a3e95112abfdfa3f0e7ba8b1a4934e24f"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#a3e95112abfdfa3f0e7ba8b1a4934e24f">KSW_XSTOP</a></div><div class="ttdeci">#define KSW_XSTOP</div><div class="ttdef"><b>Definition:</b> ksw.h:7</div></div>
<div class="ttc" id="structkswr__t_html_a0a22a140652a9e40a417a2d54e070829"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">kswr_t::score</a></div><div class="ttdeci">int score</div><div class="ttdef"><b>Definition:</b> ksw.h:15</div></div>
<div class="ttc" id="ksw_8h_html_a9cbd7ce1bac8e3745b5fa1c4f2a25000"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#a9cbd7ce1bac8e3745b5fa1c4f2a25000">KSW_XSTART</a></div><div class="ttdeci">#define KSW_XSTART</div><div class="ttdef"><b>Definition:</b> ksw.h:9</div></div>
<div class="ttc" id="ksw_8h_html_ad6340ae00716e79b4d820303710f5a21"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#ad6340ae00716e79b4d820303710f5a21">KSW_XSUBO</a></div><div class="ttdeci">#define KSW_XSUBO</div><div class="ttdef"><b>Definition:</b> ksw.h:8</div></div>
<div class="ttc" id="structkswr__t_html_aa69bf49cab94c1ece6a1cf76edb1ea9c"><div class="ttname"><a href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">kswr_t::te</a></div><div class="ttdeci">int te</div><div class="ttdef"><b>Definition:</b> ksw.h:16</div></div>
<div class="ttc" id="ksw_8c_html_a09be34a2ff991aeb136cdc5c98719111"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#a09be34a2ff991aeb136cdc5c98719111">ksw_u8</a></div><div class="ttdeci">kswr_t ksw_u8(kswq_t *q, int tlen, const uint8_t *target, int _o_del, int _e_del, int _o_ins, int _e_ins, int xtra)</div><div class="ttdef"><b>Definition:</b> ksw.c:110</div></div>
<div class="ttc" id="structkswr__t_html"><div class="ttname"><a href="../../de/d25/structkswr__t.html">kswr_t</a></div><div class="ttdef"><b>Definition:</b> ksw.h:14</div></div>
<div class="ttc" id="structkswr__t_html_a5de5440fa8fd951df5483edf55f7cddd"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">kswr_t::qe</a></div><div class="ttdeci">int qe</div><div class="ttdef"><b>Definition:</b> ksw.h:16</div></div>
<div class="ttc" id="ksw_8c_html_a9b86b0e1cab2423ed292be074a3c5c27"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#a9b86b0e1cab2423ed292be074a3c5c27">revseq</a></div><div class="ttdeci">static void revseq(int l, uint8_t *s)</div><div class="ttdef"><b>Definition:</b> ksw.c:337</div></div>
<div class="ttc" id="structkswr__t_html_a726f86a2e3be73519fa46b2a44f64a5f"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a726f86a2e3be73519fa46b2a44f64a5f">kswr_t::qb</a></div><div class="ttdeci">int qb</div><div class="ttdef"><b>Definition:</b> ksw.h:18</div></div>
<div class="ttc" id="ksw_8h_html_a388a8f0d345df67b79d92976a394ebab"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#a388a8f0d345df67b79d92976a394ebab">KSW_XBYTE</a></div><div class="ttdeci">#define KSW_XBYTE</div><div class="ttdef"><b>Definition:</b> ksw.h:6</div></div>
<div class="ttc" id="ksw_8c_html_a295f1f9c1e0144e81d4c5900a6698601"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#a295f1f9c1e0144e81d4c5900a6698601">ksw_qinit</a></div><div class="ttdeci">kswq_t * ksw_qinit(int size, int qlen, const uint8_t *query, int m, const int8_t *mat)</div><div class="ttdef"><b>Definition:</b> ksw.c:62</div></div>
<div class="ttc" id="ksw_8c_html_aa24677fdc656c726046b3166b8286bea"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#aa24677fdc656c726046b3166b8286bea">ksw_i16</a></div><div class="ttdeci">kswr_t ksw_i16(kswq_t *q, int tlen, const uint8_t *target, int _o_del, int _e_del, int _o_ins, int _e_ins, int xtra)</div><div class="ttdef"><b>Definition:</b> ksw.c:233</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8bd8bb5a192234c25cae54feb3471ea5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bd8bb5a192234c25cae54feb3471ea5">&#9670;&nbsp;</a></span>ksw_extend()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ksw_extend </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gapo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>end_bonus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>zdrop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>qle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>tle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>gtle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>gscore</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>max_off</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Extend alignment</p>
<p>The routine aligns $query and $target, assuming their upstream sequences, which are not provided, have been aligned with score $h0. In return, region [0,*qle) on the query and [0,*tle) on the target sequences are aligned together. If *gscore&gt;=0, *gscore keeps the best score such that the entire query sequence is aligned; *gtle keeps the position on the target where *gscore is achieved. Returning *gscore and *gtle helps the caller to decide whether an end-to-end hit or a partial hit is preferred.</p>
<p>The first 9 parameters are identical to those in <a class="el" href="../../d5/d97/ksw_8h.html#a99c1d07f3505122ace83bbfea572c085">ksw_global()</a></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">h0</td><td>alignment score of upstream sequences </td></tr>
    <tr><td class="paramname">_qle</td><td>(out) length of the query in the alignment </td></tr>
    <tr><td class="paramname">_tle</td><td>(out) length of the target in the alignment </td></tr>
    <tr><td class="paramname">_gtle</td><td>(out) length of the target if query is fully aligned </td></tr>
    <tr><td class="paramname">_gscore</td><td>(out) score of the best end-to-end alignment; negative if not found</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>best semi-local alignment score </dd></dl>
<div class="fragment"><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;{</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/d1c/ksw_8c.html#af5d54be11b210ddd9dae4be394350a59">ksw_extend2</a>(qlen, query, tlen, target, m, mat, gapo, gape, gapo, gape, w, end_bonus, zdrop, h0, qle, tle, gtle, gscore, max_off);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div><div class="ttc" id="ksw_8c_html_af5d54be11b210ddd9dae4be394350a59"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#af5d54be11b210ddd9dae4be394350a59">ksw_extend2</a></div><div class="ttdeci">int ksw_extend2(int qlen, const uint8_t *query, int tlen, const uint8_t *target, int m, const int8_t *mat, int o_del, int e_del, int o_ins, int e_ins, int w, int end_bonus, int zdrop, int h0, int *_qle, int *_tle, int *_gtle, int *_gscore, int *_max_off)</div><div class="ttdef"><b>Definition:</b> ksw.c:381</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af5d54be11b210ddd9dae4be394350a59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5d54be11b210ddd9dae4be394350a59">&#9670;&nbsp;</a></span>ksw_extend2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ksw_extend2 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>o_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>e_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>o_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>e_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>end_bonus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>zdrop</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>h0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>_qle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>_tle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>_gtle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>_gscore</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>_max_off</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;{</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <a class="code" href="../../d5/d2d/structeh__t.html">eh_t</a> *eh; <span class="comment">// score array</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    int8_t *qp; <span class="comment">// query profile</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <span class="keywordtype">int</span> i, j, k, oe_del = o_del + e_del, oe_ins = o_ins + e_ins, beg, end, max, max_i, max_j, max_ins, max_del, max_ie, gscore, max_off;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordflow">if</span> (h0 &lt; 0) h0 = 0;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// allocate memory</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    qp = malloc(qlen * m);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    eh = calloc(qlen + 1, 8);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// generate the query profile</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="keywordflow">for</span> (k = i = 0; k &lt; m; ++k) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="keyword">const</span> int8_t *p = &amp;mat[k * m];</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; qlen; ++j) qp[i++] = p[query[j]];</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// fill the first row</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    eh[0].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = h0; eh[1].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = h0 &gt; oe_ins? h0 - oe_ins : 0;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">for</span> (j = 2; j &lt;= qlen &amp;&amp; eh[j-1].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> &gt; e_ins; ++j)</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        eh[j].h = eh[j-1].h - e_ins;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="comment">// adjust $w if it is too large</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    k = m * m;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="keywordflow">for</span> (i = 0, max = 0; i &lt; k; ++i) <span class="comment">// get the max score</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        max = max &gt; mat[i]? max : mat[i];</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    max_ins = (int)((<span class="keywordtype">double</span>)(qlen * max + end_bonus - o_ins) / e_ins + 1.);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    max_ins = max_ins &gt; 1? max_ins : 1;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    w = w &lt; max_ins? w : max_ins;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    max_del = (int)((<span class="keywordtype">double</span>)(qlen * max + end_bonus - o_del) / e_del + 1.);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    max_del = max_del &gt; 1? max_del : 1;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    w = w &lt; max_del? w : max_del; <span class="comment">// TODO: is this necessary?</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <span class="comment">// DP loop</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    max = h0, max_i = max_j = -1; max_ie = -1, gscore = -1;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    max_off = 0;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    beg = 0, end = qlen;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(i &lt; tlen); ++i) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordtype">int</span> t, f = 0, h1, m = 0, mj = -1;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        int8_t *q = &amp;qp[target[i] * qlen];</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="comment">// compute the first column</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        h1 = h0 - (o_del + e_del * (i + 1));</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">if</span> (h1 &lt; 0) h1 = 0;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;        <span class="comment">// apply the band and the constraint (if provided)</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keywordflow">if</span> (beg &lt; i - w) beg = i - w;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">if</span> (end &gt; i + w + 1) end = i + w + 1;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        <span class="keywordflow">if</span> (end &gt; qlen) end = qlen;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        <span class="keywordflow">for</span> (j = beg; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; end); ++j) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="comment">// At the beginning of the loop: eh[j] = { H(i-1,j-1), E(i,j) }, f = F(i,j) and h1 = H(i,j-1)</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="comment">// Similar to SSE2-SW, cells are computed in the following order:</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <span class="comment">//   H(i,j)   = max{H(i-1,j-1)+S(i,j), E(i,j), F(i,j)}</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <span class="comment">//   E(i+1,j) = max{H(i,j)-gapo, E(i,j)} - gape</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            <span class="comment">//   F(i,j+1) = max{H(i,j)-gapo, F(i,j)} - gape</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <a class="code" href="../../d5/d2d/structeh__t.html">eh_t</a> *p = &amp;eh[j];</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="keywordtype">int</span> h, M = p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a>, e = p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a>; <span class="comment">// get H(i-1,j-1) and E(i-1,j)</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = h1;          <span class="comment">// set H(i,j-1) for the next row</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            M += q[j];          <span class="comment">// separating H and M to disallow a cigar like &quot;100M3I3D20M&quot;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            h = M &gt; e? M : e;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            h = h &gt; f? h : f;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            h1 = h;             <span class="comment">// save H(i,j) to h1 for the next column</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;            mj = m &gt; h? mj : j; <span class="comment">// record the position where max score is achieved</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            m = m &gt; h? m : h;   <span class="comment">// m is stored at eh[mj+1]</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            t = M - oe_del;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            t = t &gt; 0? t : 0;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            e -= e_del;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            e = e &gt; t? e : t;   <span class="comment">// computed E(i+1,j)</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a> = e;           <span class="comment">// save E(i+1,j) for the next row</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            t = M - oe_ins;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            t = t &gt; 0? t : 0;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            f -= e_ins;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            f = f &gt; t? f : t;   <span class="comment">// computed F(i,j+1)</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;        }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        eh[end].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = h1; eh[end].<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a> = 0;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keywordflow">if</span> (j == qlen) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            max_ie = gscore &gt; h1? max_ie : i;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            gscore = gscore &gt; h1? gscore : h1;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        <span class="keywordflow">if</span> (m == 0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">if</span> (m &gt; max) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            max = m, max_i = i, max_j = mj;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            max_off = max_off &gt; abs(mj - i)? max_off : abs(mj - i);</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (zdrop &gt; 0) {</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">if</span> (i - max_i &gt; mj - max_j) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                <span class="keywordflow">if</span> (max - m - ((i - max_i) - (mj - max_j)) * e_del &gt; zdrop) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keywordflow">if</span> (max - m - ((mj - max_j) - (i - max_i)) * e_ins &gt; zdrop) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            }</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        }</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;        <span class="comment">// update beg and end for the next round</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">for</span> (j = mj; j &gt;= beg &amp;&amp; eh[j].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a>; --j);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        beg = j + 1;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        <span class="keywordflow">for</span> (j = mj + 2; j &lt;= end &amp;&amp; eh[j].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a>; ++j);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        end = j;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="comment">//beg = 0; end = qlen; // uncomment this line for debugging</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    free(eh); free(qp);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span> (_qle) *_qle = max_j + 1;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keywordflow">if</span> (_tle) *_tle = max_i + 1;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">if</span> (_gtle) *_gtle = max_ie + 1;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">if</span> (_gscore) *_gscore = gscore;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordflow">if</span> (_max_off) *_max_off = max_off;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> max;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div><div class="ttc" id="structeh__t_html_a61ba384a1fe5b964445a79380b898612"><div class="ttname"><a href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">eh_t::h</a></div><div class="ttdeci">int32_t h</div><div class="ttdef"><b>Definition:</b> ksw.c:378</div></div>
<div class="ttc" id="structeh__t_html"><div class="ttname"><a href="../../d5/d2d/structeh__t.html">eh_t</a></div><div class="ttdef"><b>Definition:</b> ksw.c:377</div></div>
<div class="ttc" id="ksw_8c_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> ksw.c:39</div></div>
<div class="ttc" id="structeh__t_html_a3bb218f7528b88ccf8fc1bf56ac5064b"><div class="ttname"><a href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">eh_t::e</a></div><div class="ttdeci">int32_t e</div><div class="ttdef"><b>Definition:</b> ksw.c:378</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7b3b660c0554a2d9817528194b6578a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7b3b660c0554a2d9817528194b6578a3">&#9670;&nbsp;</a></span>ksw_global()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ksw_global </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gapo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gape</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>n_cigar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t **&#160;</td>
          <td class="paramname"><em>cigar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Banded global alignment</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qlen</td><td>query length </td></tr>
    <tr><td class="paramname">query</td><td>query sequence with 0 &lt;= query[i] &lt; m </td></tr>
    <tr><td class="paramname">tlen</td><td>target length </td></tr>
    <tr><td class="paramname">target</td><td>target sequence with 0 &lt;= target[i] &lt; m </td></tr>
    <tr><td class="paramname">m</td><td>number of residue types </td></tr>
    <tr><td class="paramname">mat</td><td>m*m scoring mattrix in one-dimension array </td></tr>
    <tr><td class="paramname">gapo</td><td>gap open penalty; a gap of length l cost "-(gapo+l*gape)" </td></tr>
    <tr><td class="paramname">gape</td><td>gap extension penalty </td></tr>
    <tr><td class="paramname">w</td><td>band width </td></tr>
    <tr><td class="paramname">n_cigar</td><td>(out) number of CIGAR elements </td></tr>
    <tr><td class="paramname">cigar</td><td>(out) BAM-encoded CIGAR; caller need to deallocate with free()</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>score of the alignment </dd></dl>
<div class="fragment"><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;{</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d6/d1c/ksw_8c.html#ab3429600af32881906c7327a78e4e284">ksw_global2</a>(qlen, query, tlen, target, m, mat, gapo, gape, gapo, gape, w, n_cigar_, cigar_);</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;}</div><div class="ttc" id="ksw_8c_html_ab3429600af32881906c7327a78e4e284"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#ab3429600af32881906c7327a78e4e284">ksw_global2</a></div><div class="ttdeci">int ksw_global2(int qlen, const uint8_t *query, int tlen, const uint8_t *target, int m, const int8_t *mat, int o_del, int e_del, int o_ins, int e_ins, int w, int *n_cigar_, uint32_t **cigar_)</div><div class="ttdef"><b>Definition:</b> ksw.c:503</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab3429600af32881906c7327a78e4e284"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3429600af32881906c7327a78e4e284">&#9670;&nbsp;</a></span>ksw_global2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ksw_global2 </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>o_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>e_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>o_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>e_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>w</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>n_cigar_</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t **&#160;</td>
          <td class="paramname"><em>cigar_</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;{</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="../../d5/d2d/structeh__t.html">eh_t</a> *eh;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    int8_t *qp; <span class="comment">// query profile</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="keywordtype">int</span> i, j, k, oe_del = o_del + e_del, oe_ins = o_ins + e_ins, score, n_col;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    uint8_t *z; <span class="comment">// backtrack matrix; in each cell: f&lt;&lt;4|e&lt;&lt;2|h; in principle, we can halve the memory, but backtrack will be a little more complex</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span> (n_cigar_) *n_cigar_ = 0;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">// allocate memory</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    n_col = qlen &lt; 2*w+1? qlen : 2*w+1; <span class="comment">// maximum #columns of the backtrack matrix</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    z = malloc(n_col * tlen);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    qp = malloc(qlen * m);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    eh = calloc(qlen + 1, 8);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">// generate the query profile</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordflow">for</span> (k = i = 0; k &lt; m; ++k) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        <span class="keyword">const</span> int8_t *p = &amp;mat[k * m];</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">for</span> (j = 0; j &lt; qlen; ++j) qp[i++] = p[query[j]];</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// fill the first row</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    eh[0].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = 0; eh[0].<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a> = <a class="code" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <span class="keywordflow">for</span> (j = 1; j &lt;= qlen &amp;&amp; j &lt;= w; ++j)</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        eh[j].h = -(o_ins + e_ins * j), eh[j].<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a> = <a class="code" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">for</span> (; j &lt;= qlen; ++j) eh[j].h = eh[j].e = <a class="code" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>; <span class="comment">// everything is -inf outside the band</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">// DP loop</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordflow">for</span> (i = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(i &lt; tlen); ++i) { <span class="comment">// target sequence is in the outer loop</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        int32_t f = <a class="code" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>, h1, beg, end, t;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        int8_t *q = &amp;qp[target[i] * qlen];</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        uint8_t *zi = &amp;z[i * n_col];</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        beg = i &gt; w? i - w : 0;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        end = i + w + 1 &lt; qlen? i + w + 1 : qlen; <span class="comment">// only loop through [beg,end) of the query sequence</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        h1 = beg == 0? -(o_del + e_del * (i + 1)) : <a class="code" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">for</span> (j = beg; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; end); ++j) {</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="comment">// At the beginning of the loop: eh[j] = { H(i-1,j-1), E(i,j) }, f = F(i,j) and h1 = H(i,j-1)</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="comment">// Cells are computed in the following order:</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="comment">//   M(i,j)   = H(i-1,j-1) + S(i,j)</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="comment">//   H(i,j)   = max{M(i,j), E(i,j), F(i,j)}</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="comment">//   E(i+1,j) = max{M(i,j)-gapo, E(i,j)} - gape</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="comment">//   F(i,j+1) = max{M(i,j)-gapo, F(i,j)} - gape</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="comment">// We have to separate M(i,j); otherwise the direction may not be recorded correctly.</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="comment">// However, a CIGAR like &quot;10M3I3D10M&quot; allowed by local() is disallowed by global().</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            <span class="comment">// Such a CIGAR may occur, in theory, if mismatch_penalty &gt; 2*gap_ext_penalty + 2*gap_open_penalty/k.</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;            <span class="comment">// In practice, this should happen very rarely given a reasonable scoring system.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <a class="code" href="../../d5/d2d/structeh__t.html">eh_t</a> *p = &amp;eh[j];</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            int32_t h, m = p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a>, e = p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            uint8_t d; <span class="comment">// direction</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = h1;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;            m += q[j];</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;            d = m &gt;= e? 0 : 1;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            h = m &gt;= e? m : e;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;            d = h &gt;= f? d : 2;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            h = h &gt;= f? h : f;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            h1 = h;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            t = m - oe_del;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            e -= e_del;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            d |= e &gt; t? 1&lt;&lt;2 : 0;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            e  = e &gt; t? e    : t;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            p-&gt;<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a> = e;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            t = m - oe_ins;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            f -= e_ins;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            d |= f &gt; t? 2&lt;&lt;4 : 0; <span class="comment">// if we want to halve the memory, use one bit only, instead of two</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            f  = f &gt; t? f    : t;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            zi[j - beg] = d; <span class="comment">// z[i,j] keeps h for the current cell and e/f for the next cell</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        eh[end].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a> = h1; eh[end].<a class="code" href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">e</a> = <a class="code" href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a>;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    score = eh[qlen].<a class="code" href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">h</a>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="keywordflow">if</span> (n_cigar_ &amp;&amp; cigar_) { <span class="comment">// backtrack</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="keywordtype">int</span> n_cigar = 0, m_cigar = 0, which = 0;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        uint32_t *cigar = 0, tmp;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        i = tlen - 1; k = (i + w + 1 &lt; qlen? i + w + 1 : qlen) - 1; <span class="comment">// (i,k) points to the last cell</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">while</span> (i &gt;= 0 &amp;&amp; k &gt;= 0) {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            which = z[i * n_col + (k - (i &gt; w? i - w : 0))] &gt;&gt; (which&lt;&lt;1) &amp; 3;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="keywordflow">if</span> (which == 0)      cigar = <a class="code" href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a>(&amp;n_cigar, &amp;m_cigar, cigar, 0, 1), --i, --k;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (which == 1) cigar = <a class="code" href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a>(&amp;n_cigar, &amp;m_cigar, cigar, 2, 1), --i;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="keywordflow">else</span>                 cigar = <a class="code" href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a>(&amp;n_cigar, &amp;m_cigar, cigar, 1, 1), --k;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        <span class="keywordflow">if</span> (i &gt;= 0) cigar = <a class="code" href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a>(&amp;n_cigar, &amp;m_cigar, cigar, 2, i + 1);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">if</span> (k &gt;= 0) cigar = <a class="code" href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a>(&amp;n_cigar, &amp;m_cigar, cigar, 1, k + 1);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; n_cigar&gt;&gt;1; ++i) <span class="comment">// reverse CIGAR</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            tmp = cigar[i], cigar[i] = cigar[n_cigar-1-i], cigar[n_cigar-1-i] = tmp;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        *n_cigar_ = n_cigar, *cigar_ = cigar;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    free(eh); free(qp); free(z);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">return</span> score;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div><div class="ttc" id="structeh__t_html_a61ba384a1fe5b964445a79380b898612"><div class="ttname"><a href="../../d5/d2d/structeh__t.html#a61ba384a1fe5b964445a79380b898612">eh_t::h</a></div><div class="ttdeci">int32_t h</div><div class="ttdef"><b>Definition:</b> ksw.c:378</div></div>
<div class="ttc" id="ksw_8c_html_a826957eb948116d000d8514b3cd85202"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#a826957eb948116d000d8514b3cd85202">push_cigar</a></div><div class="ttdeci">static uint32_t * push_cigar(int *n_cigar, int *m_cigar, uint32_t *cigar, int op, int len)</div><div class="ttdef"><b>Definition:</b> ksw.c:491</div></div>
<div class="ttc" id="structeh__t_html"><div class="ttname"><a href="../../d5/d2d/structeh__t.html">eh_t</a></div><div class="ttdef"><b>Definition:</b> ksw.c:377</div></div>
<div class="ttc" id="ksw_8c_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> ksw.c:39</div></div>
<div class="ttc" id="ksw_8c_html_aa48b28e62c168ecef26792b023bedb09"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#aa48b28e62c168ecef26792b023bedb09">MINUS_INF</a></div><div class="ttdeci">#define MINUS_INF</div><div class="ttdef"><b>Definition:</b> ksw.c:489</div></div>
<div class="ttc" id="structeh__t_html_a3bb218f7528b88ccf8fc1bf56ac5064b"><div class="ttname"><a href="../../d5/d2d/structeh__t.html#a3bb218f7528b88ccf8fc1bf56ac5064b">eh_t::e</a></div><div class="ttdeci">int32_t e</div><div class="ttdef"><b>Definition:</b> ksw.c:378</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa24677fdc656c726046b3166b8286bea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa24677fdc656c726046b3166b8286bea">&#9670;&nbsp;</a></span>ksw_i16()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a> ksw_i16 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_o_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_e_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_o_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_e_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xtra</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;{</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordtype">int</span> slen, i, m_b, n_b, te = -1, gmax = 0, minsc, endsc;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    uint64_t *b;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    __m128i zero, oe_del, e_del, oe_ins, e_ins, *H0, *H1, *E, *Hmax;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="../../de/d25/structkswr__t.html">kswr_t</a> r;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="preprocessor">#define __max_8(ret, xx) do { \</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epi16((xx), _mm_srli_si128((xx), 8)); \</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epi16((xx), _mm_srli_si128((xx), 4)); \</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epi16((xx), _mm_srli_si128((xx), 2)); \</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="preprocessor">        (ret) = _mm_extract_epi16((xx), 0); \</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="preprocessor">    } while (0)</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">// initialization</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    r = <a class="code" href="../../d6/d1c/ksw_8c.html#add79ed614f910c5fcae1eead30104f28">g_defr</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    minsc = (xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#ad6340ae00716e79b4d820303710f5a21">KSW_XSUBO</a>)? xtra&amp;0xffff : 0x10000;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    endsc = (xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#a3e95112abfdfa3f0e7ba8b1a4934e24f">KSW_XSTOP</a>)? xtra&amp;0xffff : 0x10000;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    m_b = n_b = 0; b = 0;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    zero = _mm_set1_epi32(0);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    oe_del = _mm_set1_epi16(_o_del + _e_del);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    e_del = _mm_set1_epi16(_e_del);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    oe_ins = _mm_set1_epi16(_o_ins + _e_ins);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    e_ins = _mm_set1_epi16(_e_ins);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    H0 = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">H0</a>; H1 = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">H1</a>; E = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">E</a>; Hmax = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a020ca536d07cc28ec556de16500f8b11">Hmax</a>;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    slen = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#af16cf66c480b325e1834737f20757cf0">slen</a>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; slen; ++i) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        _mm_store_si128(E + i, zero);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        _mm_store_si128(H0 + i, zero);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        _mm_store_si128(Hmax + i, zero);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">// the core loop</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; tlen; ++i) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="keywordtype">int</span> j, k, imax;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        __m128i e, t, h, f = zero, max = zero, *S = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">qp</a> + target[i] * slen; <span class="comment">// s is the 1st score vector</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        h = _mm_load_si128(H0 + slen - 1); <span class="comment">// h={2,5,8,11,14,17,-1,-1} in the above example</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        h = _mm_slli_si128(h, 2);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordflow">for</span> (j = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; slen); ++j) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            h = _mm_adds_epi16(h, *S++);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            e = _mm_load_si128(E + j);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            h = _mm_max_epi16(h, e);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            h = _mm_max_epi16(h, f);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            max = _mm_max_epi16(max, h);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            _mm_store_si128(H1 + j, h);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            e = _mm_subs_epu16(e, e_del);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            t = _mm_subs_epu16(h, oe_del);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            e = _mm_max_epi16(e, t);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            _mm_store_si128(E + j, e);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;            f = _mm_subs_epu16(f, e_ins);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            t = _mm_subs_epu16(h, oe_ins);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            f = _mm_max_epi16(f, t);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            h = _mm_load_si128(H0 + j);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">for</span> (k = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(k &lt; 16); ++k) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            f = _mm_slli_si128(f, 2);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">for</span> (j = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; slen); ++j) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                h = _mm_load_si128(H1 + j);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                h = _mm_max_epi16(h, f);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                _mm_store_si128(H1 + j, h);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                h = _mm_subs_epu16(h, oe_ins);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                f = _mm_subs_epu16(f, e_ins);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="../../d6/d1c/ksw_8c.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a>(!_mm_movemask_epi8(_mm_cmpgt_epi16(f, h)))) <span class="keywordflow">goto</span> end_loop8;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;end_loop8:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <a class="code" href="../../d6/d1c/ksw_8c.html#a287a82314c2dd8a20b9aea52a422a34b">__max_8</a>(imax, max);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (imax &gt;= minsc) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            <span class="keywordflow">if</span> (n_b == 0 || (int32_t)b[n_b-1] + 1 != i) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">if</span> (n_b == m_b) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    m_b = m_b? m_b&lt;&lt;1 : 8;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                    b = (uint64_t*)realloc(b, 8 * m_b);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                b[n_b++] = (uint64_t)imax&lt;&lt;32 | i;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(b[n_b-1]&gt;&gt;32) &lt; imax) b[n_b-1] = (uint64_t)imax&lt;&lt;32 | i; <span class="comment">// modify the last</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordflow">if</span> (imax &gt; gmax) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            gmax = imax; te = i;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordflow">for</span> (j = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; slen); ++j)</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                _mm_store_si128(Hmax + j, _mm_load_si128(H1 + j));</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">if</span> (gmax &gt;= endsc) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        S = H1; H1 = H0; H0 = S;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    }</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a> = gmax; r.<a class="code" href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">te</a> = te;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordtype">int</span> max = -1, tmp, low, high, qlen = slen * 8;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        uint16_t *t = (uint16_t*)Hmax;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">for</span> (i = 0, r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> = -1; i &lt; qlen; ++i, ++t)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)*t &gt; max) max = *t, r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> = i / 8 + i % 8 * slen;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="keywordflow">else</span> <a class="code" href="../../d5/d11/mem__share_8h.html#a92afa796856e0e070652304931d6ddac">if</a> ((<span class="keywordtype">int</span>)*t == max &amp;&amp; (tmp = i / 8 + i % 8 * slen) &lt; r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a>) r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> = tmp; </div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">if</span> (b) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            i = (r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a> + q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">max</a> - 1) / q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">max</a>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            low = te - i; high = te + i;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            for (i = 0; i &lt; n_b; ++i) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <span class="keywordtype">int</span> e = (int32_t)b[i];</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">if</span> ((e &lt; low || e &gt; high) &amp;&amp; (int)(b[i]&gt;&gt;32) &gt; r.<a class="code" href="../../de/d25/structkswr__t.html#a55947d55f5add5b4ca0a065600b45369">score2</a>)</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    r.<a class="code" href="../../de/d25/structkswr__t.html#a55947d55f5add5b4ca0a065600b45369">score2</a> = b[i]&gt;&gt;32, r.<a class="code" href="../../de/d25/structkswr__t.html#affa271b6f2b9418a45531d07b0770ee5">te2</a> = e;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    free(b);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <span class="keywordflow">return</span> r;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;}</div><div class="ttc" id="struct__kswq__t_html_af16cf66c480b325e1834737f20757cf0"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#af16cf66c480b325e1834737f20757cf0">_kswq_t::slen</a></div><div class="ttdeci">int slen</div><div class="ttdef"><b>Definition:</b> ksw.c:46</div></div>
<div class="ttc" id="ksw_8h_html_a3e95112abfdfa3f0e7ba8b1a4934e24f"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#a3e95112abfdfa3f0e7ba8b1a4934e24f">KSW_XSTOP</a></div><div class="ttdeci">#define KSW_XSTOP</div><div class="ttdef"><b>Definition:</b> ksw.h:7</div></div>
<div class="ttc" id="structkswr__t_html_a0a22a140652a9e40a417a2d54e070829"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">kswr_t::score</a></div><div class="ttdeci">int score</div><div class="ttdef"><b>Definition:</b> ksw.h:15</div></div>
<div class="ttc" id="struct__kswq__t_html_a020ca536d07cc28ec556de16500f8b11"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a020ca536d07cc28ec556de16500f8b11">_kswq_t::Hmax</a></div><div class="ttdeci">__m128i * Hmax</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a44aa16c840f95c4dcdf50492498f425c"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">_kswq_t::E</a></div><div class="ttdeci">__m128i * E</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="structkswr__t_html_affa271b6f2b9418a45531d07b0770ee5"><div class="ttname"><a href="../../de/d25/structkswr__t.html#affa271b6f2b9418a45531d07b0770ee5">kswr_t::te2</a></div><div class="ttdeci">int te2</div><div class="ttdef"><b>Definition:</b> ksw.h:17</div></div>
<div class="ttc" id="struct__kswq__t_html_a3f13153429fe6cfb83ed12adcde5eae0"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">_kswq_t::H0</a></div><div class="ttdeci">__m128i * H0</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="ksw_8h_html_ad6340ae00716e79b4d820303710f5a21"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#ad6340ae00716e79b4d820303710f5a21">KSW_XSUBO</a></div><div class="ttdeci">#define KSW_XSUBO</div><div class="ttdef"><b>Definition:</b> ksw.h:8</div></div>
<div class="ttc" id="struct__kswq__t_html_ac297509b5a0709635fd3e9b652c378ab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">_kswq_t::H1</a></div><div class="ttdeci">__m128i * H1</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a8527459f05d78893ce320ee2ad5125ab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">_kswq_t::qp</a></div><div class="ttdeci">__m128i * qp</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="mem__share_8h_html_a92afa796856e0e070652304931d6ddac"><div class="ttname"><a href="../../d5/d11/mem__share_8h.html#a92afa796856e0e070652304931d6ddac">if</a></div><div class="ttdeci">if(_proc_deamon -&gt;once)</div><div class="ttdef"><b>Definition:</b> mem_share.h:672</div></div>
<div class="ttc" id="structkswr__t_html_aa69bf49cab94c1ece6a1cf76edb1ea9c"><div class="ttname"><a href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">kswr_t::te</a></div><div class="ttdeci">int te</div><div class="ttdef"><b>Definition:</b> ksw.h:16</div></div>
<div class="ttc" id="struct__kswq__t_html_a1119b1b89127868e567d0c648576faab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">_kswq_t::max</a></div><div class="ttdeci">uint8_t max</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="ksw_8c_html_add79ed614f910c5fcae1eead30104f28"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#add79ed614f910c5fcae1eead30104f28">g_defr</a></div><div class="ttdeci">const kswr_t g_defr</div><div class="ttdef"><b>Definition:</b> ksw.c:43</div></div>
<div class="ttc" id="ksw_8c_html_ab10d0a221f4d7a706701b806c8135fd7"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)</div><div class="ttdef"><b>Definition:</b> ksw.c:40</div></div>
<div class="ttc" id="structkswr__t_html_a55947d55f5add5b4ca0a065600b45369"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a55947d55f5add5b4ca0a065600b45369">kswr_t::score2</a></div><div class="ttdeci">int score2</div><div class="ttdef"><b>Definition:</b> ksw.h:17</div></div>
<div class="ttc" id="structkswr__t_html"><div class="ttname"><a href="../../de/d25/structkswr__t.html">kswr_t</a></div><div class="ttdef"><b>Definition:</b> ksw.h:14</div></div>
<div class="ttc" id="structkswr__t_html_a5de5440fa8fd951df5483edf55f7cddd"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">kswr_t::qe</a></div><div class="ttdeci">int qe</div><div class="ttdef"><b>Definition:</b> ksw.h:16</div></div>
<div class="ttc" id="ksw_8c_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> ksw.c:39</div></div>
<div class="ttc" id="ksw_8c_html_a287a82314c2dd8a20b9aea52a422a34b"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#a287a82314c2dd8a20b9aea52a422a34b">__max_8</a></div><div class="ttdeci">#define __max_8(ret, xx)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a295f1f9c1e0144e81d4c5900a6698601"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a295f1f9c1e0144e81d4c5900a6698601">&#9670;&nbsp;</a></span>ksw_qinit()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a>* ksw_qinit </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>qlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int8_t *&#160;</td>
          <td class="paramname"><em>mat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize the query data structure</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>Number of bytes used to store a score; valid valures are 1 or 2 </td></tr>
    <tr><td class="paramname">qlen</td><td>Length of the query sequence </td></tr>
    <tr><td class="paramname">query</td><td>Query sequence </td></tr>
    <tr><td class="paramname">m</td><td>Size of the alphabet </td></tr>
    <tr><td class="paramname">mat</td><td>Scoring matrix in a one-dimension array</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Query data structure </dd></dl>
<div class="fragment"><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;{</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <a class="code" href="../../dd/dff/struct__kswq__t.html">kswq_t</a> *q;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">int</span> slen, a, tmp, p;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    size = size &gt; 1? 2 : 1;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    p = 8 * (3 - size); <span class="comment">// # values per __m128i</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    slen = (qlen + p - 1) / p; <span class="comment">// segmented length</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    q = (<a class="code" href="../../dd/dff/struct__kswq__t.html">kswq_t</a>*)malloc(<span class="keyword">sizeof</span>(<a class="code" href="../../dd/dff/struct__kswq__t.html">kswq_t</a>) + 256 + 16 * slen * (m + 4)); <span class="comment">// a single block of memory</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">qp</a> = (__m128i*)(((<span class="keywordtype">size_t</span>)q + <span class="keyword">sizeof</span>(<a class="code" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a>) + 15) &gt;&gt; 4 &lt;&lt; 4); <span class="comment">// align memory</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">H0</a> = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">qp</a> + slen * m;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">H1</a> = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">H0</a> + slen;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">E</a>  = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">H1</a> + slen;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a020ca536d07cc28ec556de16500f8b11">Hmax</a> = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">E</a> + slen;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#af16cf66c480b325e1834737f20757cf0">slen</a> = slen; q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a549694eb0697e56b8acad4d38613431f">qlen</a> = qlen; q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a7ba48bac78067bfea3285e0a868a685e">size</a> = size;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// compute shift</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    tmp = m * m;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">for</span> (a = 0, q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a> = 127, q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a0f5ac439eaa57461bb1b3108d75ee7c2">mdiff</a> = 0; a &lt; tmp; ++a) { <span class="comment">// find the minimum and maximum score</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keywordflow">if</span> (mat[a] &lt; (int8_t)q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a>) q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a> = mat[a];</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="../../d5/d11/mem__share_8h.html#a92afa796856e0e070652304931d6ddac">if</a> (mat[a] &gt; (int8_t)q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a0f5ac439eaa57461bb1b3108d75ee7c2">mdiff</a>) q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a0f5ac439eaa57461bb1b3108d75ee7c2">mdiff</a> = mat[a];</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">max</a> = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a0f5ac439eaa57461bb1b3108d75ee7c2">mdiff</a>;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a> = 256 - q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a>; <span class="comment">// NB: q-&gt;shift is uint8_t</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a0f5ac439eaa57461bb1b3108d75ee7c2">mdiff</a> += q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a>; <span class="comment">// this is the difference between the min and max scores</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// An example: p=8, qlen=19, slen=3 and segmentation:</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="comment">//  {{0,3,6,9,12,15,18,-1},{1,4,7,10,13,16,-1,-1},{2,5,8,11,14,17,-1,-1}}</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (size == 1) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        int8_t *t = (int8_t*)q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">qp</a>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        for (a = 0; a &lt; m; ++a) {</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordtype">int</span> i, k, nlen = slen * p;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keyword">const</span> int8_t *ma = mat + a * m;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; slen; ++i)</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordflow">for</span> (k = i; k &lt; nlen; k += slen) <span class="comment">// p iterations</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    *t++ = (k &gt;= qlen? 0 : ma[query[k]]) + q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a>;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        }</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        int16_t *t = (int16_t*)q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">qp</a>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        for (a = 0; a &lt; m; ++a) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="keywordtype">int</span> i, k, nlen = slen * p;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keyword">const</span> int8_t *ma = mat + a * m;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; slen; ++i)</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="keywordflow">for</span> (k = i; k &lt; nlen; k += slen) <span class="comment">// p iterations</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    *t++ = (k &gt;= qlen? 0 : ma[query[k]]);</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        }</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">return</span> q;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="ttc" id="struct__kswq__t_html"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html">_kswq_t</a></div><div class="ttdef"><b>Definition:</b> ksw.c:45</div></div>
<div class="ttc" id="ksw_8h_html_a9ff05689c463b0536ae63ffdc9d59a51"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a></div><div class="ttdeci">struct _kswq_t kswq_t</div><div class="ttdef"><b>Definition:</b> ksw.h:12</div></div>
<div class="ttc" id="struct__kswq__t_html_a7ba48bac78067bfea3285e0a868a685e"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a7ba48bac78067bfea3285e0a868a685e">_kswq_t::size</a></div><div class="ttdeci">uint8_t size</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="struct__kswq__t_html_af16cf66c480b325e1834737f20757cf0"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#af16cf66c480b325e1834737f20757cf0">_kswq_t::slen</a></div><div class="ttdeci">int slen</div><div class="ttdef"><b>Definition:</b> ksw.c:46</div></div>
<div class="ttc" id="struct__kswq__t_html_a020ca536d07cc28ec556de16500f8b11"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a020ca536d07cc28ec556de16500f8b11">_kswq_t::Hmax</a></div><div class="ttdeci">__m128i * Hmax</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a44aa16c840f95c4dcdf50492498f425c"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">_kswq_t::E</a></div><div class="ttdeci">__m128i * E</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a3f13153429fe6cfb83ed12adcde5eae0"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">_kswq_t::H0</a></div><div class="ttdeci">__m128i * H0</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_ac297509b5a0709635fd3e9b652c378ab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">_kswq_t::H1</a></div><div class="ttdeci">__m128i * H1</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a8527459f05d78893ce320ee2ad5125ab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">_kswq_t::qp</a></div><div class="ttdeci">__m128i * qp</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a0f5ac439eaa57461bb1b3108d75ee7c2"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a0f5ac439eaa57461bb1b3108d75ee7c2">_kswq_t::mdiff</a></div><div class="ttdeci">uint8_t mdiff</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="mem__share_8h_html_a92afa796856e0e070652304931d6ddac"><div class="ttname"><a href="../../d5/d11/mem__share_8h.html#a92afa796856e0e070652304931d6ddac">if</a></div><div class="ttdeci">if(_proc_deamon -&gt;once)</div><div class="ttdef"><b>Definition:</b> mem_share.h:672</div></div>
<div class="ttc" id="struct__kswq__t_html_a1119b1b89127868e567d0c648576faab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">_kswq_t::max</a></div><div class="ttdeci">uint8_t max</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="struct__kswq__t_html_a19aa39e9711e17167a1cf15997c4ff59"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">_kswq_t::shift</a></div><div class="ttdeci">uint8_t shift</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="struct__kswq__t_html_a549694eb0697e56b8acad4d38613431f"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a549694eb0697e56b8acad4d38613431f">_kswq_t::qlen</a></div><div class="ttdeci">int qlen</div><div class="ttdef"><b>Definition:</b> ksw.c:46</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a09be34a2ff991aeb136cdc5c98719111"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09be34a2ff991aeb136cdc5c98719111">&#9670;&nbsp;</a></span>ksw_u8()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a> ksw_u8 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d5/d97/ksw_8h.html#a9ff05689c463b0536ae63ffdc9d59a51">kswq_t</a> *&#160;</td>
          <td class="paramname"><em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_o_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_e_del</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_o_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>_e_ins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>xtra</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;{</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordtype">int</span> slen, i, m_b, n_b, te = -1, gmax = 0, minsc, endsc;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    uint64_t *b;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    __m128i zero, oe_del, e_del, oe_ins, e_ins, shift, *H0, *H1, *E, *Hmax;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    <a class="code" href="../../de/d25/structkswr__t.html">kswr_t</a> r;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="preprocessor">#define __max_16(ret, xx) do { \</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 8)); \</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 4)); \</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 2)); \</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="preprocessor">        (xx) = _mm_max_epu8((xx), _mm_srli_si128((xx), 1)); \</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="preprocessor">        (ret) = _mm_extract_epi16((xx), 0) &amp; 0x00ff; \</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="preprocessor">    } while (0)</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="comment">// initialization</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    r = <a class="code" href="../../d6/d1c/ksw_8c.html#add79ed614f910c5fcae1eead30104f28">g_defr</a>;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    minsc = (xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#ad6340ae00716e79b4d820303710f5a21">KSW_XSUBO</a>)? xtra&amp;0xffff : 0x10000;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    endsc = (xtra&amp;<a class="code" href="../../d5/d97/ksw_8h.html#a3e95112abfdfa3f0e7ba8b1a4934e24f">KSW_XSTOP</a>)? xtra&amp;0xffff : 0x10000;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    m_b = n_b = 0; b = 0;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    zero = _mm_set1_epi32(0);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    oe_del = _mm_set1_epi8(_o_del + _e_del);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    e_del = _mm_set1_epi8(_e_del);</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    oe_ins = _mm_set1_epi8(_o_ins + _e_ins);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    e_ins = _mm_set1_epi8(_e_ins);</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    shift = _mm_set1_epi8(q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a>);</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    H0 = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">H0</a>; H1 = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">H1</a>; E = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">E</a>; Hmax = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a020ca536d07cc28ec556de16500f8b11">Hmax</a>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    slen = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#af16cf66c480b325e1834737f20757cf0">slen</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; slen; ++i) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        _mm_store_si128(E + i, zero);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        _mm_store_si128(H0 + i, zero);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        _mm_store_si128(Hmax + i, zero);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">// the core loop</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; tlen; ++i) {</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordtype">int</span> j, k, cmp, imax;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        __m128i e, h, t, f = zero, max = zero, *S = q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">qp</a> + target[i] * slen; <span class="comment">// s is the 1st score vector</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        h = _mm_load_si128(H0 + slen - 1); <span class="comment">// h={2,5,8,11,14,17,-1,-1} in the above example</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        h = _mm_slli_si128(h, 1); <span class="comment">// h=H(i-1,-1); &lt;&lt; instead of &gt;&gt; because x64 is little-endian</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">for</span> (j = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; slen); ++j) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="comment">/* SW cells are computed in the following order:</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">             *   H(i,j)   = max{H(i-1,j-1)+S(i,j), E(i,j), F(i,j)}</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">             *   E(i+1,j) = max{H(i,j)-q, E(i,j)-r}</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">             *   F(i,j+1) = max{H(i,j)-q, F(i,j)-r}</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="comment">// compute H&#39;(i,j); note that at the beginning, h=H&#39;(i-1,j-1)</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            h = _mm_adds_epu8(h, _mm_load_si128(S + j));</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            h = _mm_subs_epu8(h, shift); <span class="comment">// h=H&#39;(i-1,j-1)+S(i,j)</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            e = _mm_load_si128(E + j); <span class="comment">// e=E&#39;(i,j)</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            h = _mm_max_epu8(h, e);</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            h = _mm_max_epu8(h, f); <span class="comment">// h=H&#39;(i,j)</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            max = _mm_max_epu8(max, h); <span class="comment">// set max</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            _mm_store_si128(H1 + j, h); <span class="comment">// save to H&#39;(i,j)</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="comment">// now compute E&#39;(i+1,j)</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            e = _mm_subs_epu8(e, e_del); <span class="comment">// e=E&#39;(i,j) - e_del</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            t = _mm_subs_epu8(h, oe_del); <span class="comment">// h=H&#39;(i,j) - o_del - e_del</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            e = _mm_max_epu8(e, t); <span class="comment">// e=E&#39;(i+1,j)</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            _mm_store_si128(E + j, e); <span class="comment">// save to E&#39;(i+1,j)</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <span class="comment">// now compute F&#39;(i,j+1)</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            f = _mm_subs_epu8(f, e_ins);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            t = _mm_subs_epu8(h, oe_ins); <span class="comment">// h=H&#39;(i,j) - o_ins - e_ins</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            f = _mm_max_epu8(f, t);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="comment">// get H&#39;(i-1,j) and prepare for the next j</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            h = _mm_load_si128(H0 + j); <span class="comment">// h=H&#39;(i-1,j)</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="comment">// NB: we do not need to set E(i,j) as we disallow adjecent insertion and then deletion</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">for</span> (k = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(k &lt; 16); ++k) { <span class="comment">// this block mimics SWPS3; NB: H(i,j) updated in the lazy-F loop cannot exceed max</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            f = _mm_slli_si128(f, 1);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordflow">for</span> (j = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; slen); ++j) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                h = _mm_load_si128(H1 + j);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                h = _mm_max_epu8(h, f); <span class="comment">// h=H&#39;(i,j)</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                _mm_store_si128(H1 + j, h);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                h = _mm_subs_epu8(h, oe_ins);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                f = _mm_subs_epu8(f, e_ins);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                cmp = _mm_movemask_epi8(_mm_cmpeq_epi8(_mm_subs_epu8(f, h), zero));</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="../../d6/d1c/ksw_8c.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a>(cmp == 0xffff)) <span class="keywordflow">goto</span> end_loop16;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;end_loop16:</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        <span class="comment">//int k;for (k=0;k&lt;16;++k)printf(&quot;%d &quot;, ((uint8_t*)&amp;max)[k]);printf(&quot;\n&quot;);</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <a class="code" href="../../d6/d1c/ksw_8c.html#a4bd40006efbe6d978381de40766e3b63">__max_16</a>(imax, max); <span class="comment">// imax is the maximum number in max</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordflow">if</span> (imax &gt;= minsc) { <span class="comment">// write the b array; this condition adds branching unfornately</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">if</span> (n_b == 0 || (int32_t)b[n_b-1] + 1 != i) { <span class="comment">// then append</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keywordflow">if</span> (n_b == m_b) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                    m_b = m_b? m_b&lt;&lt;1 : 8;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                    b = (uint64_t*)realloc(b, 8 * m_b);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                b[n_b++] = (uint64_t)imax&lt;&lt;32 | i;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(b[n_b-1]&gt;&gt;32) &lt; imax) b[n_b-1] = (uint64_t)imax&lt;&lt;32 | i; <span class="comment">// modify the last</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="keywordflow">if</span> (imax &gt; gmax) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            gmax = imax; te = i; <span class="comment">// te is the end position on the target</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="keywordflow">for</span> (j = 0; <a class="code" href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a>(j &lt; slen); ++j) <span class="comment">// keep the H1 vector</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                _mm_store_si128(Hmax + j, _mm_load_si128(H1 + j));</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">if</span> (gmax + q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a> &gt;= 255 || gmax &gt;= endsc) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        S = H1; H1 = H0; H0 = S; <span class="comment">// swap H0 and H1</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    }</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a> = gmax + q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">shift</a> &lt; 255? gmax : 255;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    r.<a class="code" href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">te</a> = te;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// modified by Jue Ruan</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">//if (r.score != 255) { // get a-&gt;qe, the end of query match; find the 2nd best score</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    { <span class="comment">// get a-&gt;qe, the end of query match; find the 2nd best score</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordtype">int</span> max = -1, tmp, low, high, qlen = slen * 16;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        uint8_t *t = (uint8_t*)Hmax;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">for</span> (i = 0; i &lt; qlen; ++i, ++t)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)*t &gt; max) max = *t, r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> = i / 16 + i % 16 * slen;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">else</span> <a class="code" href="../../d5/d11/mem__share_8h.html#a92afa796856e0e070652304931d6ddac">if</a> ((<span class="keywordtype">int</span>)*t == max &amp;&amp; (tmp = i / 16 + i % 16 * slen) &lt; r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a>) r.<a class="code" href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">qe</a> = tmp; </div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="comment">//printf(&quot;%d,%d\n&quot;, max, gmax);</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="keywordflow">if</span> (b) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            i = (r.<a class="code" href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">score</a> + q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">max</a> - 1) / q-&gt;<a class="code" href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">max</a>;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            low = te - i; high = te + i;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            for (i = 0; i &lt; n_b; ++i) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <span class="keywordtype">int</span> e = (int32_t)b[i];</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">if</span> ((e &lt; low || e &gt; high) &amp;&amp; (int)(b[i]&gt;&gt;32) &gt; r.<a class="code" href="../../de/d25/structkswr__t.html#a55947d55f5add5b4ca0a065600b45369">score2</a>)</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    r.<a class="code" href="../../de/d25/structkswr__t.html#a55947d55f5add5b4ca0a065600b45369">score2</a> = b[i]&gt;&gt;32, r.<a class="code" href="../../de/d25/structkswr__t.html#affa271b6f2b9418a45531d07b0770ee5">te2</a> = e;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    }</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    free(b);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">return</span> r;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;}</div><div class="ttc" id="struct__kswq__t_html_af16cf66c480b325e1834737f20757cf0"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#af16cf66c480b325e1834737f20757cf0">_kswq_t::slen</a></div><div class="ttdeci">int slen</div><div class="ttdef"><b>Definition:</b> ksw.c:46</div></div>
<div class="ttc" id="ksw_8h_html_a3e95112abfdfa3f0e7ba8b1a4934e24f"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#a3e95112abfdfa3f0e7ba8b1a4934e24f">KSW_XSTOP</a></div><div class="ttdeci">#define KSW_XSTOP</div><div class="ttdef"><b>Definition:</b> ksw.h:7</div></div>
<div class="ttc" id="structkswr__t_html_a0a22a140652a9e40a417a2d54e070829"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a0a22a140652a9e40a417a2d54e070829">kswr_t::score</a></div><div class="ttdeci">int score</div><div class="ttdef"><b>Definition:</b> ksw.h:15</div></div>
<div class="ttc" id="struct__kswq__t_html_a020ca536d07cc28ec556de16500f8b11"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a020ca536d07cc28ec556de16500f8b11">_kswq_t::Hmax</a></div><div class="ttdeci">__m128i * Hmax</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a44aa16c840f95c4dcdf50492498f425c"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a44aa16c840f95c4dcdf50492498f425c">_kswq_t::E</a></div><div class="ttdeci">__m128i * E</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="structkswr__t_html_affa271b6f2b9418a45531d07b0770ee5"><div class="ttname"><a href="../../de/d25/structkswr__t.html#affa271b6f2b9418a45531d07b0770ee5">kswr_t::te2</a></div><div class="ttdeci">int te2</div><div class="ttdef"><b>Definition:</b> ksw.h:17</div></div>
<div class="ttc" id="struct__kswq__t_html_a3f13153429fe6cfb83ed12adcde5eae0"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a3f13153429fe6cfb83ed12adcde5eae0">_kswq_t::H0</a></div><div class="ttdeci">__m128i * H0</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="ksw_8c_html_a4bd40006efbe6d978381de40766e3b63"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#a4bd40006efbe6d978381de40766e3b63">__max_16</a></div><div class="ttdeci">#define __max_16(ret, xx)</div></div>
<div class="ttc" id="ksw_8h_html_ad6340ae00716e79b4d820303710f5a21"><div class="ttname"><a href="../../d5/d97/ksw_8h.html#ad6340ae00716e79b4d820303710f5a21">KSW_XSUBO</a></div><div class="ttdeci">#define KSW_XSUBO</div><div class="ttdef"><b>Definition:</b> ksw.h:8</div></div>
<div class="ttc" id="struct__kswq__t_html_ac297509b5a0709635fd3e9b652c378ab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#ac297509b5a0709635fd3e9b652c378ab">_kswq_t::H1</a></div><div class="ttdeci">__m128i * H1</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="struct__kswq__t_html_a8527459f05d78893ce320ee2ad5125ab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a8527459f05d78893ce320ee2ad5125ab">_kswq_t::qp</a></div><div class="ttdeci">__m128i * qp</div><div class="ttdef"><b>Definition:</b> ksw.c:48</div></div>
<div class="ttc" id="mem__share_8h_html_a92afa796856e0e070652304931d6ddac"><div class="ttname"><a href="../../d5/d11/mem__share_8h.html#a92afa796856e0e070652304931d6ddac">if</a></div><div class="ttdeci">if(_proc_deamon -&gt;once)</div><div class="ttdef"><b>Definition:</b> mem_share.h:672</div></div>
<div class="ttc" id="structkswr__t_html_aa69bf49cab94c1ece6a1cf76edb1ea9c"><div class="ttname"><a href="../../de/d25/structkswr__t.html#aa69bf49cab94c1ece6a1cf76edb1ea9c">kswr_t::te</a></div><div class="ttdeci">int te</div><div class="ttdef"><b>Definition:</b> ksw.h:16</div></div>
<div class="ttc" id="struct__kswq__t_html_a1119b1b89127868e567d0c648576faab"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a1119b1b89127868e567d0c648576faab">_kswq_t::max</a></div><div class="ttdeci">uint8_t max</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="struct__kswq__t_html_a19aa39e9711e17167a1cf15997c4ff59"><div class="ttname"><a href="../../dd/dff/struct__kswq__t.html#a19aa39e9711e17167a1cf15997c4ff59">_kswq_t::shift</a></div><div class="ttdeci">uint8_t shift</div><div class="ttdef"><b>Definition:</b> ksw.c:47</div></div>
<div class="ttc" id="ksw_8c_html_add79ed614f910c5fcae1eead30104f28"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#add79ed614f910c5fcae1eead30104f28">g_defr</a></div><div class="ttdeci">const kswr_t g_defr</div><div class="ttdef"><b>Definition:</b> ksw.c:43</div></div>
<div class="ttc" id="ksw_8c_html_ab10d0a221f4d7a706701b806c8135fd7"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#ab10d0a221f4d7a706701b806c8135fd7">UNLIKELY</a></div><div class="ttdeci">#define UNLIKELY(x)</div><div class="ttdef"><b>Definition:</b> ksw.c:40</div></div>
<div class="ttc" id="structkswr__t_html_a55947d55f5add5b4ca0a065600b45369"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a55947d55f5add5b4ca0a065600b45369">kswr_t::score2</a></div><div class="ttdeci">int score2</div><div class="ttdef"><b>Definition:</b> ksw.h:17</div></div>
<div class="ttc" id="structkswr__t_html"><div class="ttname"><a href="../../de/d25/structkswr__t.html">kswr_t</a></div><div class="ttdef"><b>Definition:</b> ksw.h:14</div></div>
<div class="ttc" id="structkswr__t_html_a5de5440fa8fd951df5483edf55f7cddd"><div class="ttname"><a href="../../de/d25/structkswr__t.html#a5de5440fa8fd951df5483edf55f7cddd">kswr_t::qe</a></div><div class="ttdeci">int qe</div><div class="ttdef"><b>Definition:</b> ksw.h:16</div></div>
<div class="ttc" id="ksw_8c_html_affde14445f49f65ff4f5b592e44ee71a"><div class="ttname"><a href="../../d6/d1c/ksw_8c.html#affde14445f49f65ff4f5b592e44ee71a">LIKELY</a></div><div class="ttdeci">#define LIKELY(x)</div><div class="ttdef"><b>Definition:</b> ksw.c:39</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a826957eb948116d000d8514b3cd85202"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a826957eb948116d000d8514b3cd85202">&#9670;&nbsp;</a></span>push_cigar()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t* push_cigar </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>n_cigar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>m_cigar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>cigar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;{</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordflow">if</span> (*n_cigar == 0 || op != (<span class="keywordtype">int</span>)(cigar[(*n_cigar) - 1]&amp;0xf)) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">if</span> (*n_cigar == *m_cigar) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            *m_cigar = *m_cigar? (*m_cigar)&lt;&lt;1 : 4;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            cigar = realloc(cigar, (*m_cigar) &lt;&lt; 2);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        cigar[(*n_cigar)++] = len&lt;&lt;4 | op;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    } <span class="keywordflow">else</span> cigar[(*n_cigar)-1] += len&lt;&lt;4;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="keywordflow">return</span> cigar;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a9b86b0e1cab2423ed292be074a3c5c27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b86b0e1cab2423ed292be074a3c5c27">&#9670;&nbsp;</a></span>revseq()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void revseq </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>l</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;{</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <span class="keywordtype">int</span> i, t;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">for</span> (i = 0; i &lt; l&gt;&gt;1; ++i)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        t = s[i], s[i] = s[l - 1 - i], s[l - 1 - i] = t;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="add79ed614f910c5fcae1eead30104f28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add79ed614f910c5fcae1eead30104f28">&#9670;&nbsp;</a></span>g_defr</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../de/d25/structkswr__t.html">kswr_t</a> g_defr = { 0, -1, -1, -1, -1, -1, -1 }</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d6/d1c/ksw_8c.html">ksw.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
